@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@using Microsoft.AspNetCore.Http
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TYB BOOK</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/css/home.css" asp-append-version="true" />

    @RenderSection("Styles", required: false)
    <style>
        .user-dropdown {
            position: absolute !important;
            top: calc(100% + 10px) !important;
            right: 0 !important;
            background: white !important;
            border: 1px solid #ddd !important;
            border-radius: 5px !important;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1) !important;
            min-width: 200px !important;
            z-index: 1000 !important;
            display: block !important;
        }

            .user-dropdown.hidden {
                display: none !important;
            }

        .items-icon, header .col-auto {
            position: relative !important;
        }
    </style>
</head>
<body data-logged-in="@ViewBag.IsLoggedIn">
    <div class="page-wrapper">
        <header>
            <div class="container">
                <div class="row">
                    <div class="col-auto">
                        <div class="inner-logo">
                            <a href="@Url.Action("Index", "Home")">
                                <img src="/image/logo2.png" alt="TYB BOOK" class="logo-img" />
                            </a>
                        </div>
                    </div>
                    <div class="col">
                        <div class="inner-search">
                            <form asp-controller="Home" asp-action="Search" method="get" class="d-flex">
                                <input class="form-control me-2"
                                       type="search"
                                       name="q"
                                       placeholder="Tìm kiếm sách, tác giả..."
                                       value="@Context.Request.Query["q"]"
                                       autocomplete="off" />
                                <button class="btn btn-primary" type="submit">
                                    <i class="fa-solid fa-magnifying-glass"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="items-icon">
                            <div class="inner-chat">
                                <a href="@Url.Action("Index", "Chat", new { mode = "buyer" }) ">
                                    <i class="fa-solid fa-comment-dots"></i>
                                </a>
                            </div>

                            <div class="inner-cart">
                                <a href="@Url.Action("Cart", "Cart")">
                                    <i class="fa-solid fa-cart-shopping"></i>
                                    <span class="cart-item-1" id="cart-item-1">0</span>
                                </a>
                            </div>

                            <div class="inner-user" id="userIcon" style="cursor: pointer;">
                                <div>
                                    <i class="fa-regular fa-user"></i>
                                </div>
                                <div class="user-name">
                                    @{
                                        var userName = HttpContextAccessor.HttpContext.Session.GetString("UserName");
                                        if (!string.IsNullOrEmpty(userName))
                                        {
                                            <span class="username">@userName</span>
                                        }
                                        else
                                        {
                                            <p class="login-text">Đăng nhập</p>
                                        }
                                    }
                                </div>
                            </div>
                        </div>

                        <div id="userDropdownMenu" class="user-dropdown hidden">
                            <a id="profileLink" href="@Url.Action("Index", "DetailUser")" style="display: none;">Thông tin cá nhân</a>
                            <div id="sellerChannelContainer" class="dropdown-item-container" style="display: none;">
                                <a href="#" id="sellerChannelLink" class="dropdown-item-with-arrow">
                                    Kênh người bán
                                </a>
                            </div>
                            <a id="orderLink" href="@Url.Action("PaymentHistory", "Checkout")" style="display: none;">Đơn mua</a>
                            <form id="logoutForm" onsubmit="return handleLogout(event)" style="display: none;">
                                <button type="submit" id="logoutButton">Đăng xuất</button>
                            </form>
                            <a id="loginLink" href="@Url.Action("Sign_in", "User")" style="display: none;">Đăng nhập</a>
                            <a id="registerLink" href="@Url.Action("Sign_up", "User")" style="display: none;">Đăng ký</a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main id="section-one">
            @RenderBody()
        </main>
        <footer>
            <div class="container">
                <div class="row">
                    <div class="col-md-3 footer-section">
                        <div class="footer-logo">
                            <span class="title-first">TYB</span>
                            <span class="title-second">BOOK</span>
                        </div>
                        <p class="footer-slogan">
                            Nơi hội tụ tất cả những cuốn sách bạn yêu thích. Khám phá những "THẾ GIỚI MỚI, TUNG TRÀNG MỘT"
                        </p>
                    </div>

                    <div class="col-md-2 footer-section">
                        <h3>Cửa hàng</h3>
                        <ul>
                            <li><a href="#">Bán chạy nhất</a></li>
                            <li><a href="#">Bán phát hành mới</a></li>
                            <li><a href="#">Thể loại</a></li>
                        </ul>
                    </div>
                    <div class="col-md-2 footer-section">
                        <h3>Hỗ Trợ</h3>
                        <ul>
                            <li><a href="#">Trung tâm trợ giúp</a></li>
                            <li><a href="#">Hỏi đáp</a></li>
                            <li><a href="#">Khảo sát sự hài lòng</a></li>
                        </ul>
                    </div>

                    <div class="col-md-3 footer-section">
                        <h3>Liên Hệ</h3>
                        <div class="footer-contact">
                            <p>Hotline</p>
                            <p>Email</p>
                        </div>
                        <div class="social-icons">
                            <a class="facebook" target="_blank">
                                <i class="fa-brands fa-facebook-f"></i>
                            </a>
                            <a class="instagram" target="_blank">
                                <i class="fa-brands fa-instagram"></i>
                            </a>
                            <a class="youtube" target="_blank">
                                <i class="fa-brands fa-youtube"></i>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="footer-bottom">
                    <div>@@TybBook. Bản quyền thuộc về TybBook</div>
                    <div>Chính sách bảo mật và điều khoản dịch vụ</div>
                </div>
            </div>
        </footer>
        </div>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="~/js/layout.js?v=@DateTime.Now.Ticks" asp-append-version="true"></script>
        @await RenderSectionAsync("Scripts", required: false)
</body>
</html>