@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@using Microsoft.AspNetCore.Http
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Dashboard Người Bán</title>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
          integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer" />
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/css/home.css" asp-append-version="true" />
    <style>
        /* Seller Dashboard Specific Styles */
        .seller-wrapper {
            min-height: calc(100vh - 200px);
            background-color: #f5f5f5;
        }

        .seller-sidebar-col {
            background-color: #fff;
            padding: 0;
            border-right: 1px solid #e0e0e0;
        }

        .seller-content-col {
            padding: 30px;
            background-color: #f5f5f5;
        }

        .seller-menubar .nav-link {
            padding: 15px 20px;
            color: #333;
            border-bottom: 1px solid #e0e0e0;
            transition: all 0.3s;
        }

            .seller-menubar .nav-link:hover,
            .seller-menubar .nav-link.active {
                background-color: #f0f7ff;
                color: #0066cc;
                border-left: 3px solid #0066cc;
            }

        /* User Dropdown - Same as main layout */
        .user-dropdown {
            position: absolute !important;
            top: calc(100% + 10px) !important;
            right: 0 !important;
            background: white !important;
            border: 1px solid #ddd !important;
            border-radius: 5px !important;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1) !important;
            min-width: 200px !important;
            z-index: 1000 !important;
            display: block !important;
        }

            .user-dropdown.hidden {
                display: none !important;
            }

        .items-icon {
            position: relative !important;
        }

        header .col-auto {
            position: relative !important;
        }

        header .row {
            justify-content: space-between;
        }

        header .col-auto:last-child {
            margin-left: auto;
        }
    </style>
    @await RenderSectionAsync("Styles", required: false)
</head>
<body data-logged-in="@ViewBag.IsLoggedIn">
    <!-- Header - Same as _Layout.cshtml -->
    <header>
        <div class="container">
            <div class="row">
                <div class="col-auto">
                    <div class="inner-logo">
                        <a href="@Url.Action("Index", "Home")">
                            <img src="/image/logo2.png" alt="TYB BOOK" class="logo-img" />
                        </a>
                    </div>
                </div>
                <div class="col-auto">
                    <div class="items-icon">
                       
                        <!-- User Icon -->
                        <div class="inner-user" id="userIcon" style="cursor: pointer;">
                            <div>
                                <i class="fa-regular fa-user"></i>
                            </div>
                            <div class="user-name">
                                @{
                                    var userName = HttpContextAccessor.HttpContext.Session.GetString("UserName");
                                    if (!string.IsNullOrEmpty(userName))
                                    {
                                        <span class="username">@userName</span>
                                    }
                                    else
                                    {
                                        <p class="login-text">Đăng nhập</p>
                                    }
                                }
                            </div>
                        </div>
                    </div>

                    <!-- Dropdown Menu -->
                    <div id="userDropdownMenu" class="user-dropdown hidden">
                        <a id="profileLink" href="@Url.Action("Index", "DetailUser")" style="display: none;">Thông tin cá nhân</a>
                        <div id="sellerChannelContainer" class="dropdown-item-container" style="display: none;">
                            <a href="#" id="sellerChannelLink" class="dropdown-item-with-arrow">
                                Kênh người bán
                            </a>
                        </div>
                        <a id="orderLink" href="@Url.Action("PaymentHistory", "Checkout")" style="display: none;">Đơn mua</a>
                        <form id="logoutForm" onsubmit="return handleLogout(event)" style="display: none;">
                            <button type="submit" id="logoutButton">Đăng xuất</button>
                        </form>
                        <a id="loginLink" href="@Url.Action("Sign_in", "User")" style="display: none;">Đăng nhập</a>
                        <a id="registerLink" href="@Url.Action("Sign_up", "User")" style="display: none;">Đăng ký</a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Seller Dashboard Content -->
    <div id="seller-dashboard-wrapper" class="container-fluid seller-wrapper">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 p-0 seller-sidebar-col">
                @await Html.PartialAsync("~/Views/Seller/_SellerMenubar.cshtml")
            </div>

            <!-- Main Content -->
            <div class="col-md-10 seller-content-col">
                @RenderBody()
            </div>
        </div>
    </div>

    <!-- Footer - Same as _Layout.cshtml -->
    <footer>
        <div class="container">
            <div class="row">
                <!-- Logo & Slogan -->
                <div class="col-md-3 footer-section">
                    <div class="footer-logo">
                        <span class="title-first">TYB</span>
                        <span class="title-second">BOOK</span>
                    </div>
                    <p class="footer-slogan">
                        Nơi hội tụ tất cả những cuốn sách bạn yêu thích. Khám phá những "THẾ GIỚI MỚI, TUNG TRÀNG MỘT"
                    </p>
                </div>

                <!-- Cửa hàng -->
                <div class="col-md-2 footer-section">
                    <h3>Cửa hàng</h3>
                    <ul>
                        <li><a href="#">Bán chạy nhất</a></li>
                        <li><a href="#">Bán phát hành mới</a></li>
                        <li><a href="#">Thể loại</a></li>
                    </ul>
                </div>

                <!-- Hỗ trợ -->
                <div class="col-md-2 footer-section">
                    <h3>Hỗ Trợ</h3>
                    <ul>
                        <li><a href="#">Trung tâm trợ giúp</a></li>
                        <li><a href="#">Hỏi đáp</a></li>
                        <li><a href="#">Khảo sát sự hài lòng</a></li>
                    </ul>
                </div>

                <!-- Liên hệ -->
                <div class="col-md-3 footer-section">
                    <h3>Liên Hệ</h3>
                    <div class="footer-contact">
                        <p>Hotline</p>
                        <p>Email</p>
                    </div>
                    <div class="social-icons">
                        <a  class="facebook" target="_blank">
                            <i class="fa-brands fa-facebook-f"></i>
                        </a>
                        <a  class="instagram" target="_blank">
                            <i class="fa-brands fa-instagram"></i>
                        </a>
                        <a  class="youtube" target="_blank">
                            <i class="fa-brands fa-youtube"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Footer Bottom -->
            <div class="footer-bottom">
                <div>@@TybBook. Bản quyền thuộc về TybBook</div>
                <div>Chính sách bảo mật và điều khoản dịch vụ</div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/layout.js?v=@DateTime.Now.Ticks" asp-append-version="true"></script>

    <!-- Force re-initialize dropdown on every page load -->
    <script>
        console.log("=== Seller Layout Script Executing ===");

        // Wait for layout.js to load
        function waitForLayoutJs() {
            if (typeof initializeUserDropdown === 'function') {
                console.log("✅ layout.js loaded, initializing dropdown");
                initializeUserDropdown();
            } else {
                console.log("⏳ Waiting for layout.js...");
                setTimeout(waitForLayoutJs, 50);
            }
        }

        // Start waiting
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                console.log("DOM ready in seller layout");
                waitForLayoutJs();
            });
        } else {
            console.log("DOM already ready in seller layout");
            waitForLayoutJs();
        }
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>